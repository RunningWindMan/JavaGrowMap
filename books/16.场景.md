参考：https://github.com/chenjiabing666/JavaFamily

### 多机房异步架构

#### 单点故障处理

#### 批量获取分布式id

雪花id特点：

- 最高位是符号位，因为生成的 ID 总是正数，始终为0，不可用。
- 41位的时间序列，精确到毫秒级，41位的长度可以使用69年。时间位还有一个很重要的作用是可以根据时间进行排序。
- 10位的机器标识，10位的长度最多支持部署1024个节点。
- 12位的计数序列号，序列号即一系列的自增ID，可以支持同一节点同一毫秒生成多个ID序号，12位的计数序列号支持每个节点每毫秒产生4096个ID序号。

雪花id中有序列号（根据位数确定最大），AtomicLong存储获取到的id，步长设置为位数确定的最大值。之后没到最大值，都由AtomicLong.getAndIncrement获取id
雪花id获取完更新lastTimestamp，获取是同步进行的，如果并发了，下次获取主动将timestamp+1。